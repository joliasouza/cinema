<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro de Filmes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css" />

</head>
<body>
  <header class="topbar">
    <nav class="nav">
      <a href="../index.html" class="brand">üé¨ Cinema</a>
      <a href="./cadastro-filmes.html">Cadastro de Filmes</a>
      <a href="./cadastro-salas.html">Cadastro de Salas</a>
      <a href="./cadastro-sessoes.html">Cadastro de Sess√µes</a>
      <a href="./venda-ingressos.html">Venda de Ingressos</a>
      <a href="./sessoes.html">Sess√µes Dispon√≠veis</a>
    </nav>
  </header>

  <main class="container py-4">
    <h1 class="mb-3">Cadastro de Filmes</h1>
    <div id="status" class="mb-3"></div>
    <form id="form-filme" class="card card-body mb-4">
      <div class="grid">
        <div>
          <label class="form-label" for="titulo">T√≠tulo</label>
          <input class="form-control" id="titulo" name="titulo" required />
        </div>
        <div>
          <label class="form-label" for="genero">G√™nero</label>
          <select class="form-select" id="genero" name="genero" required>
            <option value="">Selecione</option>
            <option>A√ß√£o</option>
            <option>Com√©dia</option>
            <option>Drama</option>
            <option>Fantasia</option>
            <option>Fic√ß√£o Cient√≠fica</option>
            <option>Terror</option>
            <option>Anima√ß√£o</option>
          </select>
        </div>
        <div>
          <label class="form-label" for="classificacao">Classifica√ß√£o Indicativa</label>
          <select class="form-select" id="classificacao" name="classificacao" required>
            <option value="">Selecione</option>
            <option>Livre</option>
            <option>10</option>
            <option>12</option>
            <option>14</option>
            <option>16</option>
            <option>18</option>
          </select>
        </div>
        <div>
          <label class="form-label" for="duracao">Dura√ß√£o (min)</label>
          <input class="form-control" id="duracao" name="duracao" type="number" min="1" required />
        </div>
        <div>
          <label class="form-label" for="estreia">Data de Estreia</label>
          <input class="form-control" id="estreia" name="estreia" type="date" required />
        </div>
      </div>
      <div>
  <label class="form-label" for="descricao">Descri√ß√£o</label>
  <textarea class="form-control" id="descricao" name="descricao" rows="4" required></textarea>
      </div>
      <div>
        <button class="btn btn-primary" type="submit">Salvar Filme</button>
      </div>
    </form>

    <h2 class="h4 mb-3">Filmes cadastrados</h2>
    <table class="table table-dark table-striped align-middle" id="lista-filmes">
      <thead>
        <tr>
          <th>T√≠tulo</th>
          <th>G√™nero</th>
          <th>Classifica√ß√£o</th>
          <th>Dura√ß√£o</th>
          <th>Estreia</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>

  <script>
    const { STORAGE_KEYS, uid, load, addItem, setStatus } = window.Cinema;

    function render(){
      const tbody = document.querySelector('#lista-filmes tbody');
      tbody.innerHTML = '';
      for(const f of load(STORAGE_KEYS.filmes)){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${f.titulo}</td>
          <td><span class="badge">${f.genero}</span></td>
          <td>${f.classificacao}</td>
          <td>${f.duracao} min</td>
          <td>${f.estreia}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    document.getElementById('form-filme').addEventListener('submit', (e) => {
      e.preventDefault();
      const form = e.currentTarget;
      const data = {
        id: uid(),
        titulo: form.titulo.value.trim(),
        descricao: form.descricao.value.trim(),
        genero: form.genero.value,
        classificacao: form.classificacao.value,
        duracao: Number(form.duracao.value),
        estreia: form.estreia.value
      };
      if(!data.titulo || !data.descricao){
        setStatus(document.getElementById('status'), 'err', 'Preencha todos os campos.');
        return;
      }
      addItem(STORAGE_KEYS.filmes, data);
      setStatus(document.getElementById('status'), 'ok', 'Filme salvo com sucesso!');
      form.reset();
      render();
    });

    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>