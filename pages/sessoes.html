<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sess√µes Dispon√≠veis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body>
  <header class="topbar">
    <nav class="nav">
      <a href="../index.html" class="brand">üé¨ Cinema</a>
      <a href="./cadastro-filmes.html">Cadastro de Filmes</a>
      <a href="./cadastro-salas.html">Cadastro de Salas</a>
      <a href="./cadastro-sessoes.html">Cadastro de Sess√µes</a>
      <a href="./venda-ingressos.html">Venda de Ingressos</a>
      <a href="./sessoes.html">Sess√µes Dispon√≠veis</a>
    </nav>
  </header>

  <main class="container py-4">
    <h1 class="mb-3">Sess√µes Dispon√≠veis</h1>
    <div id="lista" class="cards"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>
  <script>
    const { STORAGE_KEYS, load, findById, formatDateTime } = window.Cinema;

    function render(){
      const el = document.getElementById('lista');
      const filmes = load(STORAGE_KEYS.filmes);
      const salas = load(STORAGE_KEYS.salas);
      const sessoes = load(STORAGE_KEYS.sessoes);
      const ingressos = load(STORAGE_KEYS.ingressos);

      if(sessoes.length === 0){
        el.innerHTML = '<p class="small">Nenhuma sess√£o cadastrada ainda.</p>';
        return;
      }

      el.innerHTML = '';
      for(const s of sessoes){
        const f = findById(filmes, s.filmeId);
        const sa = findById(salas, s.salaId);
        const vendidos = ingressos.filter(i => i.sessaoId === s.id).length;
        const card = document.createElement('a');
        card.className = 'card';
        card.href = `./venda-ingressos.html?sessaoId=${s.id}`;
        card.innerHTML = `
          <h3>${f ? f.titulo : '‚Äî'}</h3>
          <p><span class="badge">${sa ? sa.nome : '‚Äî'}</span> ‚Ä¢ ${formatDateTime(s.datahora)} ‚Ä¢ ${s.idioma} ${s.formato}</p>
          <p>Pre√ßo: <strong>R$ ${Number(s.preco).toFixed(2)}</strong></p>
          <p class="small">Vendidos: ${vendidos}${sa ? ` / Capacidade: ${sa.capacidade}` : ''}</p>
          <button class="primary" type="button">Comprar Ingresso</button>
        `;
        el.appendChild(card);
      }
    }

    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>