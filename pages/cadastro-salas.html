<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro de Salas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body>
  <header class="topbar">
    <nav class="nav">
      <a href="../index.html" class="brand">üé¨ Cinema</a>
      <a href="./cadastro-filmes.html">Cadastro de Filmes</a>
      <a href="./cadastro-salas.html">Cadastro de Salas</a>
      <a href="./cadastro-sessoes.html">Cadastro de Sess√µes</a>
      <a href="./venda-ingressos.html">Venda de Ingressos</a>
      <a href="./sessoes.html">Sess√µes Dispon√≠veis</a>
    </nav>
  </header>

  <main class="container py-4">
    <h1 class="mb-3">Cadastro de Salas</h1>
    <div id="status" class="mb-3"></div>

    <form id="form-sala" class="card card-body mb-4">
      <div class="grid">
        <div>
          <label class="form-label" for="nome">Nome da Sala</label>
          <input class="form-control" id="nome" name="nome" required />
        </div>
        <div>
          <label class="form-label" for="capacidade">Capacidade</label>
          <input class="form-control" id="capacidade" name="capacidade" type="number" min="1" required />
        </div>
        <div>
          <label class="form-label" for="tipo">Tipo</label>
          <select class="form-select" id="tipo" name="tipo" required>
            <option value="">Selecione</option>
            <option>2D</option>
            <option>3D</option>
            <option>IMAX</option>
          </select>
        </div>
      </div>
      <div class="mt-3">
        <button class="btn btn-primary" type="submit">Salvar Sala</button>
      </div>
    </form>

    <h2 class="h4 mb-3">Salas cadastradas</h2>
    <table class="table table-dark table-striped align-middle" id="lista-salas">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Capacidade</th>
          <th>Tipo</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/app.js"></script>
  <script>
    const { STORAGE_KEYS, uid, load, addItem, setStatus } = window.Cinema;

    function render(){
      const tbody = document.querySelector('#lista-salas tbody');
      tbody.innerHTML = '';
      for(const s of load(STORAGE_KEYS.salas)){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.nome}</td>
          <td>${s.capacidade}</td>
          <td><span class="badge">${s.tipo}</span></td>
        `;
        tbody.appendChild(tr);
      }
    }

    document.getElementById('form-sala').addEventListener('submit', (e) => {
      e.preventDefault();
      const form = e.currentTarget;
      const data = {
        id: uid(),
        nome: form.nome.value.trim(),
        capacidade: Number(form.capacidade.value),
        tipo: form.tipo.value
      };
      if(!data.nome || !data.capacidade || !data.tipo){
        setStatus(document.getElementById('status'), 'err', 'Preencha todos os campos.');
        return;
      }
      addItem(STORAGE_KEYS.salas, data);
      setStatus(document.getElementById('status'), 'ok', 'Sala salva com sucesso!');
      form.reset();
      render();
    });

    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>